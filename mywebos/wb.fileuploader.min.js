/*
 * jQuery FileUpload Plugin for WYSIWYG Web Builder
 * Copyright Pablo Software solutions 2016
 * http://www.wysiwygwebbuilder.com/
 */
(function(c){function d(b,a){this.config=c.extend(!0,{},m,a);this.el=b;this.fileList=[];this.allXHR=[]}var m={headings:["Name","Size","Remove All"],showResult:!0,script:"fileuploader.php"};d.prototype.init=function(){var b=this;b.el.on("click","a.upload-choose",function(a){a.preventDefault();b.el.find("input[type='file']").click()});b.el.on("drop change dragover",function(a){if("dragover"===a.type)return a.preventDefault(),a.stopPropagation(),!1;"drop"===a.type?(a.preventDefault(),a.stopPropagation(),
b.files=a.originalEvent.dataTransfer.files):b.files=b.el.find("input[type='file']")[0].files;b.handleFiles()});b.el.on("click","td a",function(a){a.preventDefault();var e=function(){b.el.find("table").remove();b.el.find("input[type='file']").val("");b.fileList=[]};if("upload-remove-all"==a.originalEvent.target.className)e();else{a=c(this);var f,k=a.closest("tr").children().eq(1).text();a.closest("tr").remove();c.each(b.fileList,function(b,a){a.name===k&&(f=b)});b.fileList.splice(f,1);1===b.el.find("tr").length&&
e()}});b.el.on("click","a.upload-submit",function(a){a.preventDefault();b.uploadFiles()})};d.prototype.handleFiles=function(){var b=this,a=b.el.find("div.upload-selected"),e=c("<tr/>"),f=c("<td/>"),k=c("<a/>",{href:"#"}),g;if(a.find("table").length)g=a.find("table");else{g=c("<table/>");var d=e.clone().appendTo(g),h=b.config.headings;c.each(h,function(b,a){var c=a.toLowerCase().replace(/\s/g,"_"),c=f.clone().addClass("upload-table-head "+c).appendTo(d);if(b===h.length-1){var e=k.clone().text(a).addClass("upload-remove-all");
c.html(e).attr("colspan",2)}else c.text(a)})}c.each(b.files,function(a,c){var h=e.clone();c.name.split(".");var d=k.clone().text("x").addClass("upload-remove");f.clone().text(c.name).appendTo(h);f.clone().text(Math.round(c.size/1024)+" kb").appendTo(h);f.clone().html(d).appendTo(h);f.clone().html("<div class='progress'><div class='progress-bar'/></div>").appendTo(h);h.appendTo(g);b.fileList.push(c)});a.find("table").length||g.appendTo(a)};d.prototype.handleProgress=function(b,a){var c=Math.round(b.loaded/
b.total*100);a.css("width",c+"%");a.text(c+"%")};d.prototype.uploadFiles=function(){var b=this,a=b.el.find("a.upload-submit"),e=0;a.hasClass("disabled")||(a.addClass("disabled"),c.each(b.fileList,function(a,d){var g=new FormData,l=b.el.find("div.progress-bar").eq(a);g.append("file-"+a,d);b.allXHR.push(c.ajax({type:"POST",url:b.config.script,data:g,contentType:!1,processData:!1,xhr:function(){var a=jQuery.ajaxSettings.xhr();a.upload&&(a.upload.onprogress=function(a){b.handleProgress(a,l)});return a}}).done(function(a){if("OK"!=
a){e++;var b=l.parent();b.empty();b.text(a);b.css("color","#FF0000")}}))}),c.when.apply(c,b.allXHR).done(function(){0==e&&b.el.find("table").remove();b.el.find("a.upload-submit").removeClass("disabled")}))};c.fn.FileUploader=function(b){(new d(this,b)).init();return this}})(jQuery);